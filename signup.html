<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up | UmmahConnect</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<style>
  body { background-color: #F9FAFB; }
  .fade-in { animation: fadeIn 1s ease forwards; opacity: 0; }
  @keyframes fadeIn { to { opacity: 1; } }
</style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Navbar -->
<header class="bg-white shadow-md">
  <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
    <a href="index.html" class="text-2xl font-bold text-indigo-600 hover:text-indigo-800">UmmahConnect</a>
    <nav class="space-x-6 hidden md:flex">
      <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition">Home</a>
      <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition">Sign Up</a>
      <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition">Login</a>
    </nav>
    <div class="md:hidden">
      <button id="menuBtn" class="text-gray-700 focus:outline-none"><i data-feather="menu"></i></button>
    </div>
  </div>
  <div id="mobileMenu" class="hidden flex-col space-y-2 p-4 bg-white shadow-md">
    <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition block">Home</a>
    <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition block">Sign Up</a>
    <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition block">Login</a>
  </div>
</header>

<!-- Sign Up Form -->
<div class="flex items-center justify-center flex-grow p-6">
  <div class="w-full max-w-md bg-white rounded-3xl p-8 shadow-xl fade-in">
    <h2 class="text-3xl font-bold text-center text-indigo-600 mb-6">Create Your Account</h2>
    <p class="text-center text-gray-500 mb-6">Join UmmahConnect to connect, share and empower communities.</p>

    <form id="signupForm" class="space-y-4">
      <!-- Account Type -->
      <div>
        <label class="block mb-1 font-medium text-gray-700">Account Type</label>
        <select id="accountType" name="accountType" class="w-full border border-gray-300 rounded-lg p-2">
          <option value="local">Local User</option>
          <option value="organization">Organization</option>
        </select>
      </div>

      <!-- Name -->
      <div>
        <label class="block mb-1 font-medium text-gray-700" id="nameLabel">Name</label>
        <input type="text" id="name" name="name" required class="w-full border border-gray-300 rounded-lg p-2" placeholder="Your Name">
      </div>

      <!-- Email -->
      <div>
        <label class="block mb-1 font-medium text-gray-700">Email</label>
        <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-lg p-2" placeholder="Email Address">
      </div>

      <!-- Password -->
      <div>
        <label class="block mb-1 font-medium text-gray-700">Password</label>
        <input type="password" id="password" name="password" required class="w-full border border-gray-300 rounded-lg p-2" placeholder="Password (min 6 characters)">
      </div>

      <!-- Country (for all users) -->
      <div>
        <label class="block mb-1 font-medium text-gray-700">Country</label>
        <select id="country" name="country" required class="w-full border border-gray-300 rounded-lg p-2">
          <option value="">Select Country</option>
          <option value="Afghanistan" data-code="+93">Afghanistan</option>
          <option value="Australia" data-code="+61">Australia</option>
          <option value="Austria" data-code="+43">Austria</option>
          <option value="Bangladesh" data-code="+880">Bangladesh</option>
          <option value="Belgium" data-code="+32">Belgium</option>
          <option value="Brazil" data-code="+55">Brazil</option>
          <option value="Canada" data-code="+1">Canada</option>
          <option value="China" data-code="+86">China</option>
          <option value="Denmark" data-code="+45">Denmark</option>
          <option value="Egypt" data-code="+20">Egypt</option>
          <option value="France" data-code="+33">France</option>
          <option value="Germany" data-code="+49">Germany</option>
          <option value="Greece" data-code="+30">Greece</option>
          <option value="India" data-code="+91">India</option>
          <option value="Indonesia" data-code="+62">Indonesia</option>
          <option value="Iran" data-code="+98">Iran</option>
          <option value="Iraq" data-code="+964">Iraq</option>
          <option value="Ireland" data-code="+353">Ireland</option>
          <option value="Israel" data-code="+972">Israel</option>
          <option value="Italy" data-code="+39">Italy</option>
          <option value="Japan" data-code="+81">Japan</option>
          <option value="Jordan" data-code="+962">Jordan</option>
          <option value="Kenya" data-code="+254">Kenya</option>
          <option value="Kuwait" data-code="+965">Kuwait</option>
          <option value="Malaysia" data-code="+60">Malaysia</option>
          <option value="Mexico" data-code="+52">Mexico</option>
          <option value="Nepal" data-code="+977">Nepal</option>
          <option value="Netherlands" data-code="+31">Netherlands</option>
          <option value="New Zealand" data-code="+64">New Zealand</option>
          <option value="Nigeria" data-code="+234">Nigeria</option>
          <option value="Norway" data-code="+47">Norway</option>
          <option value="Pakistan" data-code="+92">Pakistan</option>
          <option value="Philippines" data-code="+63">Philippines</option>
          <option value="Poland" data-code="+48">Poland</option>
          <option value="Qatar" data-code="+974">Qatar</option>
          <option value="Russia" data-code="+7">Russia</option>
          <option value="Saudi Arabia" data-code="+966">Saudi Arabia</option>
          <option value="Singapore" data-code="+65">Singapore</option>
          <option value="South Africa" data-code="+27">South Africa</option>
          <option value="South Korea" data-code="+82">South Korea</option>
          <option value="Spain" data-code="+34">Spain</option>
          <option value="Sweden" data-code="+46">Sweden</option>
          <option value="Switzerland" data-code="+41">Switzerland</option>
          <option value="Thailand" data-code="+66">Thailand</option>
          <option value="Turkey" data-code="+90">Turkey</option>
          <option value="UAE" data-code="+971">UAE</option>
          <option value="UK" data-code="+44">UK</option>
          <option value="USA" data-code="+1">USA</option>
          <option value="Vietnam" data-code="+84">Vietnam</option>
          <option value="Yemen" data-code="+967">Yemen</option>
        </select>
      </div>

      <!-- Organization Fields -->
      <div id="orgFields" class="hidden space-y-4">
        <!-- Contact -->
        <div>
          <label class="block mb-1 font-medium">Contact Number</label>
          <div class="flex">
            <input type="text" id="orgPhoneCode" class="w-20 p-2 border rounded-l" placeholder="+91" readonly>
            <input type="tel" id="orgPhone" class="flex-1 p-2 border rounded-r" placeholder="1234567890">
          </div>
        </div>

        <!-- Sector -->
        <div>
          <label class="block mb-1 font-medium">Sector</label>
          <select id="orgSector" class="w-full p-2 border rounded">
            <option value="">Select Sector</option>
            <option value="Medical">Medical</option>
            <option value="Education">Education</option>
            <option value="Social Service">Social Service</option>
            <option value="Others">Others</option>
          </select>
        </div>

        <!-- Website -->
        <div>
          <label class="block mb-1 font-medium">Website URL</label>
          <input type="url" id="orgWebsite" class="w-full border rounded p-2" placeholder="https://example.org">
        </div>

        <!-- Vision & Mission -->
        <div>
          <label class="block mb-1 font-medium">Vision & Mission</label>
          <textarea id="orgBrief" rows="4" class="w-full border rounded p-2" placeholder="Short description about your organization..."></textarea>
        </div>
      </div>

      <button type="submit" class="w-full py-3 rounded-xl font-bold bg-indigo-600 hover:bg-indigo-800 text-white transition transform hover:scale-105 shadow">
        Sign Up
      </button>
    </form>

    <p class="text-center text-gray-500 mt-4">
      Already have an account? <a href="login.html"
      class="text-indigo-600 hover:text-indigo-800 font-semibold">Login here</a>
    </p>
  </div>
</div>

<!-- Firebase App -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDP01Wi0jp523In30Xk_X83iOigfI6D038",
    authDomain: "ummahconnect-baf90.firebaseapp.com",
    projectId: "ummahconnect-baf90",
    storageBucket: "ummahconnect-baf90.appspot.com",
    messagingSenderId: "700913218056",
    appId: "1:700913218056:web:aacfb20f177993275a17bd",
    measurementId: "G-MHSXKL0V2J"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Elements
  const accountTypeSelect = document.getElementById('accountType');
  const orgFields = document.getElementById('orgFields');
  const countrySelect = document.getElementById('country');
  const orgPhoneCode = document.getElementById('orgPhoneCode');

  // Show/hide organization fields
  accountTypeSelect.addEventListener('change', () => {
    if(accountTypeSelect.value === 'organization') {
      orgFields.classList.remove('hidden');
      document.getElementById('nameLabel').innerText = "Organization Name";
    } else {
      orgFields.classList.add('hidden');
      document.getElementById('nameLabel').innerText = "Name";
    }
  });

  // Update country code for organization
  countrySelect.addEventListener('change', () => {
    const selectedOption = countrySelect.options[countrySelect.selectedIndex];
    const code = selectedOption.dataset.code || '';
    orgPhoneCode.value = code;
  });

  // Form submission
  const signupForm = document.getElementById('signupForm');
  signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const accountType = accountTypeSelect.value;
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const country = countrySelect.value;

    try {
      // Create user in Firebase Auth
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      // Prepare data
      let userData = {
        name,
        email,
        accountType,
        country
      };

      if(accountType === 'organization') {
        userData.phone = orgPhoneCode.value + (document.getElementById('orgPhone').value || '');
        userData.sector = document.getElementById('orgSector').value;
        userData.website = document.getElementById('orgWebsite').value;
        userData.vision = document.getElementById('orgBrief').value;
      }

      // Save to Firestore
      await setDoc(doc(db, "users", uid), userData);

      alert('Account created successfully!');
      window.location.href = "feed.html"; // redirect to dashboard/feed

    } catch (error) {
      console.error(error);
      alert("Error: " + error.message);
    }
  });

  feather.replace();
</script>
</body>
</html>
