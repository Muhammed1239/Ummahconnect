<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up | UmmahConnect</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
  <style>
    body { background-color: #F9FAFB; }
    .fade-in { animation: fadeIn 1s ease forwards; opacity: 0; }
    @keyframes fadeIn { to { opacity: 1; } }
    .iti { width: 100%; }
    .iti__flag {
      background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags.png");
    }
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .iti__flag {
        background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags@2x.png");
      }
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Navbar -->
<header class="bg-white shadow-md">
  <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
    <a href="index.html" class="text-2xl font-bold text-indigo-600 hover:text-indigo-800">UmmahConnect</a>
    <nav class="space-x-6 hidden md:flex">
      <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition">Home</a>
      <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition">Sign Up</a>
      <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition">Login</a>
    </nav>
    <div class="md:hidden">
      <button id="menuBtn" class="text-gray-700 focus:outline-none"><i data-feather="menu"></i></button>
    </div>
  </div>
  <div id="mobileMenu" class="hidden flex-col space-y-2 p-4 bg-white shadow-md">
    <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition block">Home</a>
    <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition block">Sign Up</a>
    <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition block">Login</a>
  </div>
</header>

<!-- Sign Up Form -->
<div class="flex items-center justify-center flex-grow p-6">
  <div class="w-full max-w-md bg-white rounded-3xl p-8 shadow-xl fade-in">
    <h2 class="text-3xl font-bold text-center text-indigo-600 mb-6">Create Your Account</h2>
    <form id="signupForm" class="space-y-4">
      <div>
        <label class="block mb-1 font-medium text-gray-700">Account Type</label>
        <select id="accountType" name="accountType" class="w-full border rounded-lg p-2">
          <option value="local">Local User</option>
          <option value="organization">Organization</option>
        </select>
      </div>

      <div>
        <label id="nameLabel" class="block mb-1 font-medium text-gray-700">Name</label>
        <input type="text" name="name" required class="w-full border rounded-lg p-2" placeholder="Your Name">
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Email</label>
        <input type="email" name="email" required class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Password</label>
        <input type="password" name="password" required minlength="6" class="w-full border rounded-lg p-2">
      </div>

      <!-- Country (ISO2 values used) -->
      <div>
        <label class="block mb-1 font-medium text-gray-700">Country</label>
        <select id="country" name="country" required class="w-full border rounded-lg p-2">
          <option value="">Select Country</option>
          <option value="IN">India</option>
          <option value="PK">Pakistan</option>
          <option value="US">United States</option>
          <option value="GB">United Kingdom</option>
          <option value="AE">United Arab Emirates</option>
          <option value="SA">Saudi Arabia</option>
          <!-- Add rest here... -->
        </select>
      </div>

      <div id="contactDiv" class="hidden">
        <label class="block mb-1 font-medium text-gray-700">Contact Number</label>
        <input type="tel" id="contact" name="contact" class="w-full border rounded-lg p-2">
      </div>

      <div id="sectorDiv" class="hidden">
        <label class="block mb-1 font-medium text-gray-700">Sector</label>
        <select id="sector" name="sector" class="w-full border rounded-lg p-2">
          <option value="">Select Sector</option>
          <option value="Medical">Medical</option>
          <option value="Education">Education</option>
          <option value="Social Service">Social Service</option>
        </select>
      </div>

      <div id="websiteDiv" class="hidden">
        <label class="block mb-1 font-medium text-gray-700">Website URL</label>
        <input type="url" id="website" name="website" class="w-full border rounded-lg p-2">
      </div>

      <div id="briefDiv" class="hidden">
        <label class="block mb-1 font-medium text-gray-700">Vision & Mission</label>
        <textarea id="briefing" name="briefing" rows="4" class="w-full border rounded-lg p-2"></textarea>
      </div>

      <button type="submit" class="w-full py-3 rounded-xl font-bold bg-indigo-600 hover:bg-indigo-800 text-white">
        Sign Up
      </button>
    </form>
  </div>
</div>

<!-- Firebase Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = { /* your config here */ };

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const accountTypeSelect = document.getElementById('accountType');
const sectorDiv = document.getElementById('sectorDiv');
const websiteDiv = document.getElementById('websiteDiv');
const contactDiv = document.getElementById('contactDiv');
const briefDiv = document.getElementById('briefDiv');
const nameLabel = document.getElementById('nameLabel');

accountTypeSelect.addEventListener('change', () => {
  const isOrg = accountTypeSelect.value === "organization";
  [sectorDiv, websiteDiv, contactDiv, briefDiv].forEach(div => div.classList.toggle('hidden', !isOrg));
  nameLabel.innerText = isOrg ? "Organization Name" : "Name";
});

const form = document.getElementById('signupForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const accountType = form.accountType.value;
  const contactInputInstance = window.intlTelInputGlobals.getInstance(document.getElementById('contact'));

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, form.email.value, form.password.value);
    const user = userCredential.user;

    await setDoc(doc(db, "users", user.uid), {
      id: user.uid,
      accountType,
      name: accountType === "local" ? form.name.value : "",
      orgName: accountType === "organization" ? form.name.value : "",
      email: form.email.value,
      country: form.country.value,
      sector: accountType === "organization" ? form.sector.value : "",
      website: accountType === "organization" ? form.website.value : "",
      contact: accountType === "organization" && contactInputInstance ? contactInputInstance.getNumber() : "",
      briefing: accountType === "organization" ? form.briefing.value : "",
      approved: accountType === "local"
    });

    alert("✅ Registration successful!");
    window.location.href = "login.html";
  } catch (error) {
    alert("❌ Error: " + error.message);
  }
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script>
feather.replace();
document.getElementById('menuBtn').addEventListener('click', () => {
  document.getElementById('mobileMenu').classList.toggle('hidden');
});

const contactInput = document.getElementById('contact');
if (contactInput) {
  const iti = window.intlTelInput(contactInput, {
    initialCountry: "auto",
    geoIpLookup: cb => fetch("https://ipapi.co/json").then(res => res.json()).then(d => cb(d.country_code)).catch(() => cb("us")),
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    separateDialCode: true,
    preferredCountries: ['us', 'gb', 'in', 'pk', 'sa', 'ae']
  });

  document.getElementById('country').addEventListener('change', function() {
    if (this.value) iti.setCountry(this.value.toLowerCase());
  });
}
</script>
</body>
</html>
