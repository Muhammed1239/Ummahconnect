<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login | UmmahConnect</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<style>
  body { background-color: #F9FAFB; }
  .fade-in { animation: fadeIn 1s ease forwards; opacity: 0; }
  @keyframes fadeIn { to { opacity: 1; } }
</style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Navbar -->
<header class="bg-white shadow-md">
  <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
    <a href="index.html" class="text-2xl font-bold text-indigo-600 hover:text-indigo-800">UmmahConnect</a>
    <nav class="space-x-6 hidden md:flex">
      <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition">Home</a>
      <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition">Sign Up</a>
      <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition">Login</a>
    </nav>
    <div class="md:hidden">
      <button id="menuBtn" class="text-gray-700 focus:outline-none"><i data-feather="menu"></i></button>
    </div>
  </div>
  <div id="mobileMenu" class="hidden flex-col space-y-2 p-4 bg-white shadow-md">
    <a href="index.html" class="text-gray-700 hover:text-indigo-600 transition block">Home</a>
    <a href="signup.html" class="text-gray-700 hover:text-indigo-600 transition block">Sign Up</a>
    <a href="login.html" class="text-gray-700 hover:text-indigo-600 transition block">Login</a>
  </div>
</header>

<!-- Login Form -->
<div class="flex items-center justify-center flex-grow p-6">
  <div class="w-full max-w-md bg-white rounded-3xl p-8 shadow-xl fade-in">
    <h2 class="text-3xl font-bold text-center text-indigo-600 mb-6">Welcome Back</h2>
    <p class="text-center text-gray-500 mb-6">Login to your account to continue connecting.</p>

    <form id="loginForm" class="space-y-4">
      <div>
        <label class="block mb-1 font-medium text-gray-700">Email</label>
        <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-lg p-2" placeholder="Email Address">
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Password</label>
        <input type="password" id="password" name="password" required class="w-full border border-gray-300 rounded-lg p-2" placeholder="Password">
      </div>

      <button type="submit" class="w-full py-3 rounded-xl font-bold bg-indigo-600 hover:bg-indigo-800 text-white transition transform hover:scale-105 shadow">
        Login
      </button>
    </form>

    <p class="text-center text-gray-500 mt-4">
      Don't have an account? <a href="signup.html" class="text-indigo-600 hover:text-indigo-800 font-semibold">Sign Up</a>
    </p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDP01Wi0jp523In30Xk_X83iOigfI6D038",
  authDomain: "ummahconnect-baf90.firebaseapp.com",
  projectId: "ummahconnect-baf90",
  storageBucket: "ummahconnect-baf90.firebasestorage.app",
  messagingSenderId: "700913218056",
  appId: "1:700913218056:web:aacfb20f177993275a17bd",
  measurementId: "G-MHSXKL0V2J"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById('loginForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = form.email.value;
  const password = form.password.value;

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Fetch user data from Firestore
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const userData = docSnap.data();

      // Check organization approval
      if(userData.accountType === "organization" && !userData.approved) {
        alert("❌ Your organization is not approved by admin yet.");
        return;
      }

      // Save to session storage
      sessionStorage.setItem("user", JSON.stringify(userData));
      alert("✅ Login successful!");

      // Redirect to feed page
      window.location.href = "feed.html";
    } else {
      alert("❌ User data not found.");
    }
  } catch (error) {
    alert("❌ Error: " + error.message);
  }
});
</script>

<script>
  feather.replace();
  const menuBtn = document.getElementById('menuBtn');
  const mobileMenu = document.getElementById('mobileMenu');
  menuBtn.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });
</script>

</body>
</html>
